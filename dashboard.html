<!DOCTYPE html>  
<html lang="es">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
  <title>Dashboard - SociosXIT</title>  

  <!-- Tailwind y Firebase SDK -->
  <script src="https://cdn.tailwindcss.com"></script>  
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>  
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>  

  <!-- Tu configuraciÃ³n externa de Firebase -->
  <script src="firebase-config.js"></script>

  <style>
    /* ====== TU CSS ORIGINAL SIN CAMBIOS ====== */
    body {
      background-color: #0b0b0b;
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
    }

    #particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    .app-root {
      position: relative;
      z-index: 10;
    }

    .neon-text {
      text-shadow: 0 0 5px #00fff0, 0 0 10px #00fff0, 0 0 20px #00fff0;
    }

    .side-menu {
      background: rgba(15, 15, 15, 0.95);
      backdrop-filter: blur(12px);
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
    }

    .btn {
      background: linear-gradient(90deg, #00e0ff, #0075ff);
      color: white;
      border: none;
      border-radius: 1rem;
      padding: 0.75rem 1.5rem;
      transition: 0.3s;
    }

    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px #00e0ff;
    }
  </style>
</head>

<body class="text-white p-4 md:p-8 hide-on-main">
  <canvas id="particles"></canvas>
  <div class="app-root">

    <!-- === BotÃ³n hamburguesa === -->
    <button id="menuButton" class="fixed top-5 left-5 z-50 bg-cyan-600 p-2 rounded-lg md:hidden">
      â˜°
    </button>

    <!-- === MenÃº lateral === -->
    <aside id="sideMenu" class="side-menu fixed top-0 left-0 w-64 h-full transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out p-4">
      <h2 class="text-2xl font-bold mb-6 neon-text">SociosXIT</h2>
      <nav class="flex flex-col gap-4">
        <a href="#" class="hover:text-cyan-400">Inicio</a>
        <a href="#" class="hover:text-cyan-400">Publicaciones</a>
        <a href="#" class="hover:text-cyan-400">Perfil</a>
        <a href="#" class="hover:text-cyan-400">Cerrar sesiÃ³n</a>
      </nav>
    </aside>

    <!-- === Contenido principal === -->
    <main class="md:ml-72 mt-10">
      <h1 class="text-3xl font-bold mb-4 neon-text">Bienvenido, <span id="userName">Usuario</span></h1>
      <p class="mb-6 text-lg">Saldo: <span id="userBalance">0</span> USD</p>

      <!-- Barra de progreso -->
      <div class="w-full bg-gray-700 rounded-full h-5 mb-6 overflow-hidden">
        <div id="levelBar" class="h-5 bg-gradient-to-r from-cyan-400 to-blue-600 rounded-full transition-all duration-700 ease-in-out" style="width: 0%;"></div>
      </div>
      <p id="userLevel" class="text-center text-lg font-semibold">Sin rango</p>

      <!-- SecciÃ³n de publicaciones -->
      <section id="publications" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mt-10">
        <!-- Las publicaciones se cargan aquÃ­ dinÃ¡micamente -->
      </section>
    </main>

  </div>

  <!-- === Scripts === -->
  <script>
    /* ===================== PARTICLES NEON (lightweight) ===================== */
    (function() {
      const canvas = document.getElementById('particles');
      const ctx = canvas.getContext('2d');
      let w = canvas.width = innerWidth;
      let h = canvas.height = innerHeight;
      const colors = [
        'rgba(0,240,255,0.95)',
        'rgba(255,77,240,0.95)',
        'rgba(0,255,136,0.95)',
        'rgba(255,212,96,0.95)'
      ];
      const particles = [];
      const PARTICLE_COUNT = Math.floor((w*h)/80000)+30;
      function rand(min,max){return Math.random()*(max-min)+min;}
      function makeParticle(){
        return {x:rand(0,w),y:rand(0,h),vx:rand(-0.3,0.3),vy:rand(-0.15,0.15),
        r:rand(0.7,2.6),life:rand(60,240),
        hue:colors[Math.floor(Math.random()*colors.length)],glow:rand(6,18)};
      }
      for(let i=0;i<PARTICLE_COUNT;i++) particles.push(makeParticle());
      function resize(){w=canvas.width=innerWidth;h=canvas.height=innerHeight;}
      addEventListener('resize',resize);
      function draw(){
        ctx.clearRect(0,0,w,h);
        const g=ctx.createLinearGradient(0,0,w,h);
        g.addColorStop(0,'rgba(10,8,20,0.0)');
        g.addColorStop(1,'rgba(6,4,12,0.12)');
        ctx.fillStyle=g;ctx.fillRect(0,0,w,h);
        for(let p of particles){
          p.x+=p.vx;p.y+=p.vy;p.life--;
          if(p.x<-20)p.x=w+20;if(p.x>w+20)p.x=-20;
          if(p.y<-20)p.y=h+20;if(p.y>h+20)p.y=-20;
          if(p.life<=0){Object.assign(p,makeParticle());p.x=rand(0,w);p.y=rand(0,h);}
          ctx.beginPath();
          const grd=ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.glow);
          grd.addColorStop(0,p.hue);
          grd.addColorStop(0.15,p.hue.replace('1)','0.35)'));
          grd.addColorStop(0.6,p.hue.replace('1)','0.08)'));
          grd.addColorStop(1,'rgba(0,0,0,0)');
          ctx.fillStyle=grd;
          ctx.arc(p.x,p.y,p.r*3+(p.glow/6),0,Math.PI*2);
          ctx.fill();
        }
        ctx.lineWidth=0.6;
        for(let i=0;i<particles.length;i++){
          for(let j=i+1;j<particles.length&&j<i+4;j++){
            const a=particles[i],b=particles[j];
            const dx=a.x-b.x,dy=a.y-b.y,d2=dx*dx+dy*dy;
            if(d2<25000){
              const alpha=1-d2/25000;
              ctx.strokeStyle='rgba(120,200,255,'+(alpha*0.06)+')';
              ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);ctx.stroke();
            }
          }
        }
        requestAnimationFrame(draw);
      }
      resize();draw();
    })();

    /* ===================== APP LOGIC ===================== */
    const db = firebase.database();
    const pubsRef = db.ref("publications");

    // === Mostrar publicaciones ===
    pubsRef.on("value", (snapshot) => {
      const publicationsContainer = document.getElementById("publications");
      publicationsContainer.innerHTML = "";
      snapshot.forEach((childSnapshot) => {
        const pub = childSnapshot.val();
        const card = document.createElement("div");
        card.className = "card p-4";
        card.innerHTML = `
          <h3 class="text-xl font-bold mb-2">${pub.titulo}</h3>
          <p class="mb-4">${pub.descripcion}</p>
          <button class="btn comprar-btn">Comprar</button>
        `;
        publicationsContainer.appendChild(card);
      });
    });

    // === MenÃº lateral ===
    const menuButton = document.getElementById("menuButton");
    const sideMenu = document.getElementById("sideMenu");
    menuButton.addEventListener("click", () => {
      sideMenu.classList.toggle("-translate-x-full");
    });

    // === Barra de progreso (niveles) ===
    const levelBar = document.getElementById("levelBar");
    const userLevel = document.getElementById("userLevel");
    const userBalance = document.getElementById("userBalance");

    function actualizarBarra() {
      const gasto = parseFloat(localStorage.getItem("gastoTotal")) || 0;
      let porcentaje = Math.min((gasto / 200) * 100, 100);
      levelBar.style.width = porcentaje + "%";

      if (gasto >= 200) {
        userLevel.textContent = "ðŸŒŸ Super Estrella";
        levelBar.style.background = "linear-gradient(90deg, #ff008c, #ffcf00)";
      } else if (gasto >= 100) {
        userLevel.textContent = "ðŸ’Ž Diamante";
        levelBar.style.background = "linear-gradient(90deg, #00d4ff, #0077ff)";
      } else if (gasto >= 50) {
        userLevel.textContent = "ðŸ”¥ VIP";
        levelBar.style.background = "linear-gradient(90deg, #00ff99, #00d4ff)";
      } else {
        userLevel.textContent = "Sin rango";
        levelBar.style.background = "linear-gradient(90deg, #555, #666)";
      }

      userBalance.textContent = gasto.toFixed(2);
    }

    actualizarBarra();
  </script>
</body>
</html>
